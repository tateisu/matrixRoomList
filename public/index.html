<html lang="ja">
<meta charset="UTF-8"/>

<script src="https://cdn.jsdelivr.net/npm/@riversun/sortable-table/lib/sortable-table.js"></script>
<script>

function showTable(data){
	const sortableTable = new SortableTable();

	sortableTable.setTable(document.querySelector('#my-table1'));

	sortableTable.setCellRenderer((col, row) => {
	    const colValue = row[col.id];

		if (col.isHeader) {
			// cell-is-a-header
	    	if (typeof colValue === 'undefined') return '<th></th>'

			return `<th>${colValue}</th>`;
		}else{
			// cell-is-not-a-header
		    if (typeof colValue === 'undefined') return '<td></td>';

		    if (col.id === 'avatarUrlHttp') return `<td><img src="${colValue}"/></td>`;

			return `<td>${colValue}</td>`;
		}
	});

	sortableTable.setData(data);
}

window.onload = function() {
	let cacheBuster = Math.floor( (new Date().getTime()) / 3600000).toString();

	let dataUrl ="./data.json";
	if( window.location.href.toString().startsWith("file://") ){
		dataUrl = "https://matrix-room-list-jp.netlify.app/data.json";
	}

	fetch(`${dataUrl}?_=${cacheBuster}`)
	  .then(response => response.json())
	  .then(data => showTable(data));
};

</script>
<noscript>JavaScriptを有効にしてください。</noscript>
<div class="sortable-table">
    <table id="my-table1" BORDER="1">
        <thead>
        <tr>
            <th data-id="num_joined_members" sortable>人数</th>
            <th data-id="avatarUrlHttp" sortable>画像</th>
            <th data-id="name" sortable>name</th>
            <th data-id="topic" sortable>トピック</th>
            <th data-id="canonical_alias" sortable>公開名</th>
            <th data-id="world_readable_int" sortable>外部から閲覧可</th>
            <th data-id="guest_can_join_int" sortable>ゲストでも参加可能</th>
            <th data-id="room_id" sortable>部屋ID</th>
        </tr>
        </thead>
    </table>
</div>
</html>
